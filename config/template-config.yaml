# Photo Statistics Configuration Template
# Copy this file to config.yaml and customize it for your needs
#
# This file defines:
# 1. Which file types are considered photo/image files
# 2. Which file types REQUIRE XMP sidecar files
# 3. What metadata sidecar extensions are valid

# File types that should be scanned
# All extensions listed here will be counted in statistics
photo_extensions:
  - .dng      # DNG files (already contain metadata, no sidecar needed)
  - .tiff     # TIFF files (already contain metadata, no sidecar needed)
  - .tif      # TIFF files (already contain metadata, no sidecar needed)
  - .cr3      # Canon CR3 RAW (requires XMP sidecar)
  # Uncomment or add additional formats as needed:
  # - .nef     # Nikon RAW (requires XMP sidecar)
  # - .arw     # Sony RAW (requires XMP sidecar)
  # - .orf     # Olympus RAW (requires XMP sidecar)
  # - .rw2     # Panasonic RAW (requires XMP sidecar)
  # - .pef     # Pentax RAW (requires XMP sidecar)
  # - .raf     # Fujifilm RAW (requires XMP sidecar)
  # - .raw     # Generic RAW (requires XMP sidecar)
  # - .crw     # Canon RAW older (requires XMP sidecar)
  # - .cr2     # Canon RAW (requires XMP sidecar)
  # - .jpg     # JPEG (may or may not need sidecar)
  # - .jpeg    # JPEG (may or may not need sidecar)

# File types that REQUIRE XMP sidecar files
# Only these will be flagged as "orphaned" if they don't have a matching .xmp file
# Note: DNG and TIFF typically embed metadata, so they don't need sidecars
require_sidecar:
  - .cr3
  # Uncomment formats that require sidecars in your workflow:
  # - .nef
  # - .arw
  # - .orf
  # - .rw2
  # - .pef
  # - .raf
  # - .raw
  # - .crw
  # - .cr2

# Valid metadata sidecar file extensions
metadata_extensions:
  - .xmp

# Camera ID mappings for Photo Pairing Tool
# Maps 4-character camera IDs to camera information
# Structure: camera_id -> list of cameras (v1.0 uses first entry only)
camera_mappings:
  # Example entries (will be populated automatically on first run):
  # AB3D:
  #   - name: "Canon EOS R5"
  #     serial_number: "12345"
  # XYZW:
  #   - name: "Sony A7IV"
  #     serial_number: ""

# Processing method descriptions for Photo Pairing Tool
# Maps processing method keywords found in filenames to descriptions
processing_methods:
  # Example entries (will be populated automatically on first run):
  # "HDR": "High Dynamic Range processing"
  # "BW": "Black and white conversion"
  # "PANO": "Panorama stitching"
  # Processing methods used in pipeline validation (add suffixes to filenames):
  "DxO_DeepPRIME_XD2s": "DNG Conversion with DxO DeepPRIME XD2s"
  "Edit": "Photoshop Editing"

# Pipeline Validation Tool Configuration
# Defines expected photo processing workflows as directed graphs
# Used by pipeline_validation.py to validate file completeness
# Multiple pipeline versions can be defined (e.g., default, v2, experimental)
processing_pipelines:
  default:
    nodes:
      # --- CAPTURE NODE (Starting Point) ---
      - id: "capture"
        type: "Capture"
        name: "Camera Capture"
        output: ["raw_image_1", "xmp_metadata_1"]

      # --- FILE NODES (Expected Files) ---
      - id: "raw_image_1"
        type: "File"
        extension: ".CR3"
        name: "Canon Raw File"
        output: ["selection_process"]

      - id: "xmp_metadata_1"
        type: "File"
        extension: ".XMP"
        name: "XMP Metadata Sidecar"
        output: []  # Terminal file node (always present)

      # --- PROCESS NODES (Editing/Conversion Steps) ---
      - id: "selection_process"
        type: "Process"
        method_ids: [""]  # Empty string means no suffix added (selection only)
        name: "Image Selection"
        output: ["dng_conversion"]

      - id: "dng_conversion"
        type: "Process"
        method_ids: ["DxO_DeepPRIME_XD2s"]  # Adds "-DxO_DeepPRIME_XD2s" suffix
        name: "DNG Conversion with DeepPRIME"
        output: ["openformat_raw_image", "xmp_metadata_2"]

      - id: "openformat_raw_image"
        type: "File"
        extension: ".DNG"
        name: "Open Format Raw (DNG)"
        output: ["individual_photoshop_process"]

      - id: "xmp_metadata_2"
        type: "File"
        extension: ".XMP"
        name: "DNG Metadata Sidecar"
        output: []

      - id: "individual_photoshop_process"
        type: "Process"
        method_ids: ["Edit"]  # Adds "-Edit" suffix (can loop: -Edit-Edit-Edit...)
        name: "Photoshop Editing"
        output: ["tiff_generation_branching"]

      # --- BRANCHING NODE (Conditional Path) ---
      - id: "tiff_generation_branching"
        type: "Branching"
        condition_description: "User decides: Create final TIFF or continue editing"
        name: "TIFF Generation Decision"
        output: ["generate_tiff_process", "individual_photoshop_process"]  # Second output creates loop

      - id: "generate_tiff_process"
        type: "Process"
        method_ids: [""]  # No suffix (TIFF generation preserves filename)
        name: "Generate Final TIFF"
        output: ["tiff_image"]

      - id: "tiff_image"
        type: "File"
        extension: ".TIF"
        name: "Final TIFF File"
        output: ["termination_blackbox"]

      # --- TERMINATION NODE (Archival Ready) ---
      - id: "termination_blackbox"
        type: "Termination"
        termination_type: "Black Box Archive"
        name: "Black Box Archive Ready"
        output: []  # Termination nodes have no outputs

# =============================================================================
# Node Types Reference
# =============================================================================
#
# All 6 node types with required properties:
#
# 1. CAPTURE NODE (Starting point - exactly one required per pipeline)
#    Required: id, type, name, output
#    Example:
#      - id: capture
#        type: Capture
#        name: Camera Capture
#        output: [raw_file, xmp_file]
#
# 2. FILE NODE (Represents expected files in the workflow)
#    Required: id, type, name, output, extension
#    Example:
#      - id: raw_file
#        type: File
#        name: Canon Raw File
#        extension: .CR3
#        output: [next_step]
#
# 3. PROCESS NODE (Editing/conversion steps that add filename suffixes)
#    Required: id, type, name, output, method_ids
#    Example:
#      - id: dng_conversion
#        type: Process
#        name: DNG Conversion
#        method_ids: [DxO_DeepPRIME_XD2s]  # Adds "-DxO_DeepPRIME_XD2s" suffix
#        output: [dng_file]
#
#    Note: method_ids can be empty string [""] for no suffix (e.g., selection step)
#
# 4. PAIRING NODE (Combines paths from 2 upstream branches using Cartesian product)
#    Required: id, type, name, output, pairing_type, input_count
#    Example:
#      - id: metadata_pairing
#        type: Pairing
#        name: Raw + XMP Pairing
#        pairing_type: Metadata      # Type of pairing (Metadata, ImageGroup, HDR, etc.)
#        input_count: 2              # MUST be 2 (exactly 2 inputs required)
#        output: [next_step]
#
#    CRITICAL RESTRICTIONS:
#    - Must have exactly 2 nodes outputting to this pairing node (validated at runtime)
#    - Cannot be in loops (MAX_ITERATIONS=1, path truncated if revisited)
#    - Processed in topological order (upstream pairing nodes first)
#
#    PATH MERGING LOGIC:
#    - If branch 1 has N paths and branch 2 has M paths → N×M merged paths generated
#    - Merged depth = max(depth1, depth2)
#    - Merged files = union(files1, files2) [automatically deduplicated]
#    - Merged iterations = max per node_id across both paths
#
# 5. BRANCHING NODE (Conditional paths - explores ALL branches)
#    Required: id, type, name, output, condition_description
#    Example:
#      - id: tiff_decision
#        type: Branching
#        name: TIFF Generation Decision
#        condition_description: "User decides: Create TIFF or continue editing"
#        output: [generate_tiff, continue_editing]  # All branches explored
#
#    Note: One output can loop back to create iterative workflows (limited to 5 iterations)
#
# 6. TERMINATION NODE (End point - at least one required per pipeline)
#    Required: id, type, name, output, termination_type
#    Example:
#      - id: termination_blackbox
#        type: Termination
#        name: Black Box Archive Ready
#        termination_type: Black Box Archive
#        output: []  # Termination nodes must have empty output
#
# =============================================================================
# Pipeline Validation Behavior
# =============================================================================
#
# - Validation enumerates ALL paths from Capture to Termination nodes
# - Branching nodes explore ALL branches (not just one)
# - Pairing nodes combine paths using Cartesian product (branch1 × branch2)
#   * Processed in topological order (upstream pairing first)
#   * Cannot be in loops (MAX_ITERATIONS=1 for pairing nodes)
# - Loops are limited to 5 iterations per Process node (prevents infinite paths)
# - Files are classified as:
#   * CONSISTENT: All expected files present, no extra files
#   * CONSISTENT-WITH-WARNING: All expected files present, but extra files exist
#   * PARTIAL: Some expected files missing
#   * INCONSISTENT: No matching paths (completely wrong files)
#
# For complex workflows and troubleshooting, see docs/pipeline-validation.md
